services:
  mail-ingest:
    build: ${PROJECT_ROOT}/services/mail-system/mail-ingest
    container_name: mail-ingest
    profiles:
    - mailserver
    restart: unless-stopped
    environment:
    - MAILGUN_WEBHOOK_SIGNING_KEY=${MAILGUN_WEBHOOK_SIGNING_KEY}
    - MAILSERVER_HOST=mailserver
    - MAILSERVER_PORT=25
    - MAILSERVER_HELO_DOMAIN=mail-ingest.${BASE_DOMAIN}
    expose:
    - '3000'
    depends_on:
      mailserver:
        condition: service_healthy
    healthcheck:
      test:
      - CMD
      - python
      - -c
      - import urllib.request; urllib.request.urlopen('http://localhost:3000/healthz')
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
    - default
