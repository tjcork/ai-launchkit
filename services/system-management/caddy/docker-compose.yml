services:
  caddy:
    container_name: caddy
    image: docker.io/library/caddy:2-alpine
    ports:
    - 127.0.0.1:80:80
    - 127.0.0.1:443:443
    - 127.0.0.1:7687:7687
    restart: unless-stopped
    volumes:
    - ./config/Caddyfile:/etc/caddy/Caddyfile:ro
    - ./config/addons:/etc/caddy/addons:ro
    - ./data/data:/data:rw
    - ./data/config:/config:rw
    # Website is now served by landing-page service
    # - ./data/website:/srv/website
    env_file:
      - .env
    environment:
    - BASE_DOMAIN=${BASE_DOMAIN}
    - COMFYUI_HOSTNAME=${COMFYUI_HOSTNAME}
    - COMFYUI_PASSWORD_HASH=${COMFYUI_PASSWORD_HASH}
    - COMFYUI_USERNAME=${COMFYUI_USERNAME}
    - BASEROW_HOSTNAME=${BASEROW_HOSTNAME}
    - BASEROW_USERNAME=${BASEROW_USERNAME}
    - BASEROW_PASSWORD_HASH=${BASEROW_PASSWORD_HASH}
    - NOCODB_HOSTNAME=${NOCODB_HOSTNAME}
    - DIFY_HOSTNAME=${DIFY_HOSTNAME}
    - FLOWISE_HOSTNAME=${FLOWISE_HOSTNAME}
    - BOLT_HOSTNAME=${BOLT_HOSTNAME}
    - BOLT_USERNAME=${BOLT_USERNAME}
    - BOLT_PASSWORD_HASH=${BOLT_PASSWORD_HASH}
    - OPENUI_HOSTNAME=${OPENUI_HOSTNAME}
    - GRAFANA_HOSTNAME=${GRAFANA_HOSTNAME}
    - WHISPER_HOSTNAME=${WHISPER_HOSTNAME}
    - LANGFUSE_HOSTNAME=${LANGFUSE_HOSTNAME}
    - LEANTIME_HOSTNAME=${LEANTIME_HOSTNAME}
    - PRIMARY_EMAIL=${PRIMARY_EMAIL}
    - LETSENCRYPT_EMAIL=${LETSENCRYPT_EMAIL:-internal}
    - LETTA_HOSTNAME=${LETTA_HOSTNAME}
    - LIBRETRANSLATE_HOSTNAME=${LIBRETRANSLATE_HOSTNAME}
    - LIBRETRANSLATE_USERNAME=${LIBRETRANSLATE_USERNAME}
    - LIBRETRANSLATE_PASSWORD_HASH=${LIBRETRANSLATE_PASSWORD_HASH}
    - LIGHTRAG_HOSTNAME=${LIGHTRAG_HOSTNAME}
    - ODOO_HOSTNAME=${ODOO_HOSTNAME}
    - ODOO_USERNAME=${ODOO_USERNAME}
    - ODOO_PASSWORD_HASH=${ODOO_PASSWORD_HASH}
    - TWENTY_CRM_HOSTNAME=${TWENTY_CRM_HOSTNAME}
    - ESPOCRM_HOSTNAME=${ESPOCRM_HOSTNAME}
    - MAUTIC_HOSTNAME=${MAUTIC_HOSTNAME}
    - PERPLEXICA_HOSTNAME=${PERPLEXICA_HOSTNAME}
    - PERPLEXICA_USERNAME=${PERPLEXICA_USERNAME}
    - PERPLEXICA_PASSWORD_HASH=${PERPLEXICA_PASSWORD_HASH}
    - N8N_HOSTNAME=${N8N_HOSTNAME}
    - NEO4J_HOSTNAME=${NEO4J_HOSTNAME}
    - PORTAINER_HOSTNAME=${PORTAINER_HOSTNAME}
    - POSTIZ_HOSTNAME=${POSTIZ_HOSTNAME}
    - PROMETHEUS_HOSTNAME=${PROMETHEUS_HOSTNAME}
    - PROMETHEUS_PASSWORD_HASH=${PROMETHEUS_PASSWORD_HASH}
    - PROMETHEUS_USERNAME=${PROMETHEUS_USERNAME}
    - QDRANT_HOSTNAME=${QDRANT_HOSTNAME}
    - RAGAPP_HOSTNAME=${RAGAPP_HOSTNAME}
    - RAGAPP_PASSWORD_HASH=${RAGAPP_PASSWORD_HASH}
    - RAGAPP_USERNAME=${RAGAPP_USERNAME}
    - SEARXNG_HOSTNAME=${SEARXNG_HOSTNAME}
    - SEARXNG_PASSWORD_HASH=${SEARXNG_PASSWORD_HASH}
    - SEARXNG_USERNAME=${SEARXNG_USERNAME}
    - SUPABASE_HOSTNAME=${SUPABASE_HOSTNAME}
    - TTS_AUTH_USER=${TTS_AUTH_USER}
    - TTS_AUTH_PASSWORD_HASH=${TTS_AUTH_PASSWORD_HASH}
    - TTS_HOSTNAME=${TTS_HOSTNAME}
    - SCRIBERR_HOSTNAME=${SCRIBERR_HOSTNAME}
    - VIKUNJA_HOSTNAME=${VIKUNJA_HOSTNAME}
    - WEAVIATE_HOSTNAME=${WEAVIATE_HOSTNAME}
    - WEBUI_HOSTNAME=${WEBUI_HOSTNAME}
    - WHISPER_AUTH_USER=${WHISPER_AUTH_USER}
    - WHISPER_AUTH_PASSWORD_HASH=${WHISPER_AUTH_PASSWORD_HASH}
    - CALCOM_HOSTNAME=${CALCOM_HOSTNAME}
    - JITSI_HOSTNAME=${JITSI_HOSTNAME}
    - VAULTWARDEN_HOSTNAME=${VAULTWARDEN_HOSTNAME}
    - KOPIA_HOSTNAME=${KOPIA_HOSTNAME}
    - KIMAI_HOSTNAME=${KIMAI_HOSTNAME}
    - INVOICENINJA_HOSTNAME=${INVOICENINJA_HOSTNAME}
    - FORMBRICKS_HOSTNAME=${FORMBRICKS_HOSTNAME}
    - METABASE_HOSTNAME=${METABASE_HOSTNAME}
    - STIRLING_HOSTNAME=${STIRLING_HOSTNAME}
    - STIRLING_USERNAME=${STIRLING_USERNAME}
    - CHATTERBOX_HOSTNAME=${CHATTERBOX_HOSTNAME}
    - CHATTERBOX_FRONTEND_HOSTNAME=${CHATTERBOX_FRONTEND_HOSTNAME}
    - LIVEKIT_HOSTNAME=${LIVEKIT_HOSTNAME}
    - N8N_MCP_HOSTNAME=${N8N_MCP_HOSTNAME}
    - GPTR_HOSTNAME=${GPTR_HOSTNAME}
    - GPTR_USERNAME=${GPTR_USERNAME}
    - GPTR_PASSWORD_HASH=${GPTR_PASSWORD_HASH}
    - LDR_HOSTNAME=${LDR_HOSTNAME}
    - LDR_USERNAME=${LDR_USERNAME}
    - LDR_PASSWORD_HASH=${LDR_PASSWORD_HASH}
    - SEAFILE_HOSTNAME=${SEAFILE_HOSTNAME}
    - PAPERLESS_HOSTNAME=${PAPERLESS_HOSTNAME}
    - OPENNOTEBOOK_HOSTNAME=${OPENNOTEBOOK_HOSTNAME}
    - WEBHOOK_TESTER_HOSTNAME=${WEBHOOK_TESTER_HOSTNAME}
    - WEBHOOK_TESTER_USERNAME=${WEBHOOK_TESTER_USERNAME}
    - WEBHOOK_TESTER_PASSWORD_HASH=${WEBHOOK_TESTER_PASSWORD_HASH}
    - HOPPSCOTCH_HOSTNAME=${HOPPSCOTCH_HOSTNAME}
    - UPTIME_KUMA_HOSTNAME=${UPTIME_KUMA_HOSTNAME}
    - AIRBYTE_HOSTNAME=${AIRBYTE_HOSTNAME}
    - PAPERLESS_GPT_HOSTNAME=${PAPERLESS_GPT_HOSTNAME}
    - PAPERLESS_GPT_USERNAME=${PAPERLESS_GPT_USERNAME}
    - PAPERLESS_GPT_PASSWORD_HASH=${PAPERLESS_GPT_PASSWORD_HASH}
    - PAPERLESS_AI_HOSTNAME=${PAPERLESS_AI_HOSTNAME}
    - HOMEPAGE_HOSTNAME=${HOMEPAGE_HOSTNAME}
    - OUTLINE_HOSTNAME=${OUTLINE_HOSTNAME}
    - OUTLINE_S3_HOSTNAME=${OUTLINE_S3_HOSTNAME}
    - OUTLINE_S3_ADMIN_HOSTNAME=${OUTLINE_S3_ADMIN_HOSTNAME}
    - GITEA_HOSTNAME=${GITEA_HOSTNAME}
    - DOCUSEAL_HOSTNAME=${DOCUSEAL_HOSTNAME}
    - DEX_HOSTNAME=${DEX_HOSTNAME}
    - MAILPIT_HOSTNAME=${MAILPIT_HOSTNAME}
    - MAILPIT_USERNAME=${MAILPIT_USERNAME}
    - MAILPIT_PASSWORD_HASH=${MAILPIT_PASSWORD_HASH}
    - MAILSERVER_WEBMAIL_HOSTNAME=${MAILSERVER_WEBMAIL_HOSTNAME}
    - SNAPPYMAIL_HOSTNAME=${SNAPPYMAIL_HOSTNAME}
    - MAIL_INGEST_HOSTNAME=${MAIL_INGEST_HOSTNAME}
    cap_drop:
    - ALL
    cap_add:
    - NET_BIND_SERVICE
    logging:
      driver: json-file
      options:
        max-size: 1m
        max-file: '1'
    healthcheck:
      test:
      - CMD
      - wget
      - --no-verbose
      - --tries=1
      - --spider
      - http://127.0.0.1:2019/metrics
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  caddy-data: {}
  caddy-config: {}
