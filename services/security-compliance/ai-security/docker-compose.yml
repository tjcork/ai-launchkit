services:
  flair-pii:
    build:
      context: ./docker/flair-pii
      dockerfile: Dockerfile
    container_name: flair-pii
    env_file:
      - .env
    profiles:
    - ai-security
    restart: unless-stopped
    volumes:
    - ${PROJECT_ROOT}/services/.shared-resources/shared:/data/shared
    healthcheck:
      test:
      - CMD
      - python
      - -c
      - import requests; requests.get('http://localhost:8000/health').raise_for_status()
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s
  llm-guard:
    image: laiyer/llm-guard-api:latest
    container_name: llm-guard
    profiles:
    - ai-security
    restart: unless-stopped
    env_file:
      - .env
    environment:
    - AUTH_TOKEN=${LLM_GUARD_TOKEN}
    - LOG_LEVEL=${LLM_GUARD_LOG_LEVEL:-INFO}
    - APP_WORKERS=2
    - CACHE_MAX_SIZE=100
    - CACHE_TTL=3600
    - SCAN_FAIL_FAST=false
    volumes:
    - ${PROJECT_ROOT}/services/.shared-resources/shared:/data/shared
    healthcheck:
      test:
      - CMD-SHELL
      - curl -fsS http://localhost:8000/health || exit 1
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 40s
  presidio-analyzer:
    image: mcr.microsoft.com/presidio-analyzer:latest
    container_name: presidio-analyzer
    profiles:
    - ai-security
    restart: unless-stopped
    env_file:
      - .env
    environment:
    - PORT=3000
    - ANALYZER_MIN_SCORE=${PRESIDIO_MIN_SCORE:-0.5}
    volumes:
    - ${PROJECT_ROOT}/services/.shared-resources/shared:/data/shared
    healthcheck:
      test:
      - CMD-SHELL
      - curl -fsS http://localhost:3000/health || exit 1
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
  presidio-anonymizer:
    image: mcr.microsoft.com/presidio-anonymizer:latest
    container_name: presidio-anonymizer
    profiles:
    - ai-security
    restart: unless-stopped
    env_file:
      - .env
    environment:
    - PORT=3000
    volumes:
    - ${PROJECT_ROOT}/services/.shared-resources/shared:/data/shared
    healthcheck:
      test:
      - CMD-SHELL
      - curl -fsS http://localhost:3000/health || exit 1
      interval: 30s
      timeout: 10s
      retries: 3

